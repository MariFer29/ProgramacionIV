<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Beneficiarios / Terceros</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="volver()">
        <ion-icon name="arrow-undo-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Mensajes -->
  <div *ngIf="successMessage" class="success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="error">
    {{ errorMessage }}
  </div>

  <!-- ============================
       FORMULARIO DE BENEFICIARIO
  ================================= -->
  <form [formGroup]="form" (ngSubmit)="guardar()">

    <ion-item>
      <ion-label position="stacked">Alias</ion-label>
      <ion-input formControlName="alias" placeholder="Ej: Mamá, Amigo, Empresa X"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Banco</ion-label>
      <ion-input formControlName="bank" placeholder="Ej: BAC, BCR, Davivienda"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Moneda</ion-label>
      <ion-select formControlName="currency" placeholder="Seleccione moneda">
        <ion-select-option value="1">CRC</ion-select-option>
        <ion-select-option value="2">USD</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Número de cuenta</ion-label>
      <ion-input formControlName="accountNumber" type="text" placeholder="Ej: 1234567890123456"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">País</ion-label>
      <ion-input formControlName="country" placeholder="Ej: Costa Rica, Colombia"></ion-input>
    </ion-item>

    <div class="buttons ion-margin-top">
      <ion-button type="submit" expand="block" [disabled]="form.invalid || loading">
        {{ editingId == null ? 'GUARDAR' : 'ACTUALIZAR' }}
      </ion-button>
      <ion-button *ngIf="editingId != null" type="button" color="medium" expand="block" (click)="cancelarEdicion()">
        Cancelar edición
      </ion-button>
    </div>

    <ion-spinner *ngIf="loading" class="ion-margin-top"></ion-spinner>
  </form>

  <!-- ============================
       FILTRO DE BÚSQUEDA
  ================================= -->
  <ion-item class="ion-margin-top">
    <ion-label position="floating">Buscar por alias, banco o país</ion-label>
    <ion-input [(ngModel)]="searchTerm" (ionInput)="filtrarBeneficiarios()"></ion-input>
  </ion-item>

  <!-- ============================
       LISTA DE BENEFICIARIOS
  ================================= -->
  <ion-card class="ion-margin-top">
    <ion-card-header>
      <ion-card-title>Beneficiarios registrados</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let b of beneficiariosFiltrados">
          <ion-label>
            <h2>{{ b.alias }} - {{ b.bank }}</h2>
            <p>
              Cuenta: {{ b.accountNumber }}<br>
              Moneda: {{ b.currency === 2 ? 'USD' : 'CRC' }}<br>
              País: {{ b.country }}
            </p>
          </ion-label>

          <ion-buttons slot="end">
            <ion-button color="warning" (click)="seleccionarParaEditar(b)">
              Editar
            </ion-button>
            <ion-button color="danger" (click)="confirmarEliminar(b)">
              Eliminar
            </ion-button>
          </ion-buttons>
        </ion-item>

        <ion-item *ngIf="!loading && beneficiariosFiltrados.length === 0">
          <ion-label>No hay beneficiarios registrados.</ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

</ion-content>
